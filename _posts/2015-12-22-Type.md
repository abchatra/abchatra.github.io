---
layout: post
title: Type (Blog in progress)
---

###Introduction
Javascript is an untyped language. [Type](https://github.com/Microsoft/ChakraCore/blob/master/lib/Runtime/Types/Type.h#L22) in the context of this blog refers to a data structure in the Chakra runtime which holds additional information about an object. Type is also popularly known as hidden class. Sole purpose of type in the runtime is to enhance performance of the user script code. If you are building your own javascript runtime and didn't care about performance or the memory you don't need type. Let us see how type shares data. 

###Static Type
Every [RecyclableObject](https://github.com/Microsoft/ChakraCore/blob/master/lib/Runtime/Types/RecyclableObject.h#L191) holds a pointer to a type. Every object class in Chakra inherits from RecyclableObject except [tagged floats](http://abchatra.github.io/TaggedFloat/). Lets take an example:

```js
var greeting = "hello";
var message = "open source";
```

Here we have two literal strings `greeting` and `message` which Chakra tracks as a [JavascriptString](https://github.com/Microsoft/ChakraCore/blob/master/lib/Runtime/Library/JavascriptString.h#L50). JavascriptString class inherits from RecyclableObject. Both `greeting` and `message` points to a shared type. 

![Object Layout]({{ site.baseurl }}/images/2015-12-22-Type-StaticTypesharing.png)

Type here has a [TypeId](https://github.com/Microsoft/ChakraCore/blob/master/lib/Runtime/Types/EdgeJavascriptTypeId.h#L23) field which is TypeIds_String. It may seem overkill to share an integer TypeId when you have to add a pointer to that type in the literal string objects. In reality type contains lot of additional data not just the type id. Following is the field dump of the type. Prototype and entrypoint are the other important information about the which are shared as well.

```C++
Js::Type
	typeId	TypeIds_String (7)	Js::TypeId
	flags		
	javascriptLibrary*
	prototype*
	entryPoint*
	propertyCache*
```

JavscriptString type is a [static type](https://github.com/Microsoft/ChakraCore/blob/master/lib/Runtime/Types/StaticType.h). Static type are for objects which can't store custom properties. For example: String, Boolean, Number etc. Dynamic objects provide lot more opportunity to share information. Dynamic objects have dynamic types. 

###Dynamic Type
Lets take a look at dynamic objects. 

```js
function Point(x, y)
{ 
  this.x = x;
  this.y = y;
}
var one = new Point(10,20);
var two = new Point(40,50);

print(one.x);
print(two.x);
```

Above script creates two *Point* objects which has properties x and y. Chakra needs to store following information in the runtime:

1.  Objects one and two have properties x and y
2.  Object one has property x whose value is 10 and property y whose value is 20
3.  Object two has property x whose value is 40 and property y whose value is 50

Above information needs to be retrieved when script wants to get or set the property. Typical way to store this information is in a form of a property map and a slot array.

- Property map (or type) maps between property and slot number. Example: Property x is present at slot 0. 
- Slot array stores the values. Example slots[0] contains value of property x. 

When script does *o.x*, Chakra fetches *o->type* map to figure out the slot number corresponding to x which is 0. Then it fetches *o->slots[0]* to get the value 10. 

Following diagram to illustrates the same. 

![Object Layout]({{ site.baseurl }}/images/2015-12-22-Type-ObjectLayout-sharing.png)

As you can see in the above type is common across all the objects created from constructor *Point*. This information is shareable and hence need for types. 




###Summary
